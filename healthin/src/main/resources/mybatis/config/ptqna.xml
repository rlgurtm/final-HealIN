<?xml version="1.0" encoding="UTF-8"?>
<!-- Sql Mapper -->
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ptqna">
	<resultMap type="tipBoardVO" id="tipBoardRM">
		<result property="memberVO.id" column="id" />
		<result property="memberVO.name" column="name" />
		<result property="memberVO.nickname" column="nickname" />
	</resultMap>
 	<select id="getPtQnaList" resultMap="tipBoardRM">
 		select a.* from
		(select row_number() over(order by board_no desc) rnum,t.board_no as no,t.title,t.hits,
		to_char(t.posted_date,'YYYY.MM.DD') as postedDate,t.category,t.id,t.tipqna,m.name
		from tipandqna t,health_member m
		where t.id=m.id and t.tipqna='ptqna') a 
        where rnum between #{startRowNumber} and #{endRowNumber}
 	</select>
 	<select id="getptQnaCategoryList" resultMap="tipBoardRM">
 		select a.* from
		(select row_number() over(order by board_no desc) rnum,t.board_no as no,t.title,t.hits,
		to_char(t.posted_date,'YYYY.MM.DD') as postedDate,t.category,t.id,t.tipqna,m.name
		from tipandqna t,health_member m
		where t.id=m.id and t.tipqna='ptqna' and t.category=#{category}) a 
        where rnum between #{startRowNumber} and #{endRowNumber}
 	</select>
 	<select id="getTotalPtQnaCount" resultType="int">
 		select count(*) from tipandqna where tipqna='ptqna'
 	</select>
 	<select id="getTotalPtQnaCategoryCount" resultType="int">
 		select count(*) from tipandqna where tipqna='ptqna' and category=#{value}
 	</select>
 	<update id="ptQnaHitsCount" parameterType="int">
		update tipandqna set hits=hits+1 where board_no=#{value} 
	</update>
	<select id="getptQnaDetailContent" resultMap="tipBoardRM">
		select t.board_no as no,t.title,t.content,t.attached_file as attachedFile,
 		t.hits,to_char(t.posted_date,'YYYY.MM.DD HH:MM:SS') as postedDate,
 		t.category,t.id,t.tipqna,m.name,m.nickname
		from tipandqna t,health_member m
		where t.id=m.id and t.tipqna='ptqna' and t.board_no=#{value}
	</select>
	<insert id="ptQnaWrite" parameterType="tipBoardVO">
	 	<selectKey keyProperty="no" resultType="int" order="BEFORE">
			select board_no_seq.nextval from dual
		</selectKey> 
		 	insert into tipandqna
			values(#{no},#{title},#{content},#{attachedFile},0,sysdate,#{category},#{memberVO.id},'ptqna')
	</insert>
	<delete id="ptQnaDelete" parameterType="map">
 		delete from tipandqna where board_no=#{no} and id=#{id}
 	</delete>
 	<update id="ptQnaUpdate" parameterType="tipBoardVO">
		update tipandqna set title=#{title},content=#{content},posted_date=sysdate where board_no=#{no}
 	</update>
</mapper>
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
















